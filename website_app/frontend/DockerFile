# 1) Build stage
FROM node:20-slim AS build
WORKDIR /app

# 1a) Install OS deps (if you need native modules)
RUN apt-get update \
  && apt-get install -y --no-install-recommends python3 build-essential \
  && rm -rf /var/lib/apt/lists/*

# 1b) Copy just the manifests and install
COPY website_app/frontend/package*.json ./
RUN npm ci

# 1c) Copy your source (without node_modules)
COPY website_app/frontend/ .

# 1d) Build your app
RUN npm run build       # CRA → /app/build, Vite → /app/dist

# 2) Production stage
FROM nginx:alpine
COPY --from=build /app/build /usr/share/nginx/html

# SPA fallback
RUN printf '\
  server {                      \
  listen 80;                  \
  root /usr/share/nginx/html; \
  index index.html;           \
  location / {                \
  try_files $uri /index.html; \
  }                           \
  }\n' > /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]



