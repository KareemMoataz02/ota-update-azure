# ---------- build the React bundle ----------
FROM node:20-alpine AS build
WORKDIR /src

# copy only package*.json so Docker cache is effective
COPY package*.json ./

# install dependencies (npm ci requires a lockfile; npm install works without one)
RUN npm install         

# bring in the rest of your source
COPY website_app/frontend/ .

# build your static assets
RUN npm run build                 

# ---------- lightweight Nginx image ----------
FROM nginx:alpine

# copy build artifacts into Nginx
COPY --from=build /src/dist /usr/share/nginx/html

# serve index.html on any route (SPA fallback)
RUN printf 'server { \
  listen 80; \
  location / { try_files $uri /index.html; } \
  }' > /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]




